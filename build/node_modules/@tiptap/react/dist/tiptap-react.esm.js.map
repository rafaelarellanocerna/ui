{"version":3,"file":"tiptap-react.esm.js","sources":["../../../../../node_modules/@tiptap/react/dist/tiptap-react.esm.js"],"sourcesContent":["import { Editor as Editor$1, NodeView } from '@tiptap/core';\nexport * from '@tiptap/core';\nimport React, { useState, useEffect, createContext, useContext } from 'react';\nimport { BubbleMenuPlugin } from '@tiptap/extension-bubble-menu';\nimport { FloatingMenuPlugin } from '@tiptap/extension-floating-menu';\nimport ReactDOM from 'react-dom';\n\nconst BubbleMenu = (props) => {\r\n    const [element, setElement] = useState(null);\r\n    useEffect(() => {\r\n        if (!element) {\r\n            return;\r\n        }\r\n        if (props.editor.isDestroyed) {\r\n            return;\r\n        }\r\n        const { pluginKey = 'bubbleMenu', editor, tippyOptions = {}, shouldShow = null, } = props;\r\n        const plugin = BubbleMenuPlugin({\r\n            pluginKey,\r\n            editor,\r\n            element,\r\n            tippyOptions,\r\n            shouldShow,\r\n        });\r\n        editor.registerPlugin(plugin);\r\n        return () => editor.unregisterPlugin(pluginKey);\r\n    }, [\r\n        props.editor,\r\n        element,\r\n    ]);\r\n    return (React.createElement(\"div\", { ref: setElement, className: props.className, style: { visibility: 'hidden' } }, props.children));\r\n};\n\nclass Editor extends Editor$1 {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.contentComponent = null;\r\n    }\r\n}\n\nconst FloatingMenu = (props) => {\r\n    const [element, setElement] = useState(null);\r\n    useEffect(() => {\r\n        if (!element) {\r\n            return;\r\n        }\r\n        if (props.editor.isDestroyed) {\r\n            return;\r\n        }\r\n        const { pluginKey = 'floatingMenu', editor, tippyOptions = {}, shouldShow = null, } = props;\r\n        const plugin = FloatingMenuPlugin({\r\n            pluginKey,\r\n            editor,\r\n            element,\r\n            tippyOptions,\r\n            shouldShow,\r\n        });\r\n        editor.registerPlugin(plugin);\r\n        return () => editor.unregisterPlugin(pluginKey);\r\n    }, [\r\n        props.editor,\r\n        element,\r\n    ]);\r\n    return (React.createElement(\"div\", { ref: setElement, className: props.className, style: { visibility: 'hidden' } }, props.children));\r\n};\n\nfunction useForceUpdate() {\r\n    const [, setValue] = useState(0);\r\n    return () => setValue(value => value + 1);\r\n}\r\nconst useEditor = (options = {}, deps = []) => {\r\n    const [editor, setEditor] = useState(null);\r\n    const forceUpdate = useForceUpdate();\r\n    useEffect(() => {\r\n        const instance = new Editor(options);\r\n        setEditor(instance);\r\n        instance.on('transaction', () => {\r\n            requestAnimationFrame(() => {\r\n                requestAnimationFrame(() => {\r\n                    forceUpdate();\r\n                });\r\n            });\r\n        });\r\n        return () => {\r\n            instance.destroy();\r\n        };\r\n    }, deps);\r\n    return editor;\r\n};\n\nfunction isClassComponent(Component) {\r\n    return !!(typeof Component === 'function'\r\n        && Component.prototype\r\n        && Component.prototype.isReactComponent);\r\n}\r\nfunction isForwardRefComponent(Component) {\r\n    var _a;\r\n    return !!(typeof Component === 'object'\r\n        && ((_a = Component.$$typeof) === null || _a === void 0 ? void 0 : _a.toString()) === 'Symbol(react.forward_ref)');\r\n}\r\nclass ReactRenderer {\r\n    constructor(component, { editor, props = {}, as = 'div', className = '', }) {\r\n        this.ref = null;\r\n        this.id = Math.floor(Math.random() * 0xFFFFFFFF).toString();\r\n        this.component = component;\r\n        this.editor = editor;\r\n        this.props = props;\r\n        this.element = document.createElement(as);\r\n        this.element.classList.add('react-renderer');\r\n        if (className) {\r\n            this.element.classList.add(...className.split(' '));\r\n        }\r\n        this.render();\r\n    }\r\n    render() {\r\n        var _a;\r\n        const Component = this.component;\r\n        const props = this.props;\r\n        if (isClassComponent(Component) || isForwardRefComponent(Component)) {\r\n            props.ref = (ref) => {\r\n                this.ref = ref;\r\n            };\r\n        }\r\n        this.reactElement = React.createElement(Component, { ...props });\r\n        if ((_a = this.editor) === null || _a === void 0 ? void 0 : _a.contentComponent) {\r\n            this.editor.contentComponent.setState({\r\n                renderers: this.editor.contentComponent.state.renderers.set(this.id, this),\r\n            });\r\n        }\r\n    }\r\n    updateProps(props = {}) {\r\n        this.props = {\r\n            ...this.props,\r\n            ...props,\r\n        };\r\n        this.render();\r\n    }\r\n    destroy() {\r\n        var _a;\r\n        if ((_a = this.editor) === null || _a === void 0 ? void 0 : _a.contentComponent) {\r\n            const { renderers } = this.editor.contentComponent.state;\r\n            renderers.delete(this.id);\r\n            this.editor.contentComponent.setState({\r\n                renderers,\r\n            });\r\n        }\r\n    }\r\n}\n\nconst ReactNodeViewContext = createContext({\r\n    onDragStart: undefined,\r\n});\r\nconst useReactNodeView = () => useContext(ReactNodeViewContext);\n\nclass ReactNodeView extends NodeView {\r\n    mount() {\r\n        const props = {\r\n            editor: this.editor,\r\n            node: this.node,\r\n            decorations: this.decorations,\r\n            selected: false,\r\n            extension: this.extension,\r\n            getPos: () => this.getPos(),\r\n            updateAttributes: (attributes = {}) => this.updateAttributes(attributes),\r\n            deleteNode: () => this.deleteNode(),\r\n        };\r\n        if (!this.component.displayName) {\r\n            const capitalizeFirstChar = (string) => {\r\n                return string.charAt(0).toUpperCase() + string.substring(1);\r\n            };\r\n            this.component.displayName = capitalizeFirstChar(this.extension.name);\r\n        }\r\n        const ReactNodeViewProvider = componentProps => {\r\n            const Component = this.component;\r\n            const onDragStart = this.onDragStart.bind(this);\r\n            const nodeViewContentRef = element => {\r\n                if (element\r\n                    && this.contentDOMElement\r\n                    && element.firstChild !== this.contentDOMElement) {\r\n                    element.appendChild(this.contentDOMElement);\r\n                }\r\n            };\r\n            return (React.createElement(ReactNodeViewContext.Provider, { value: { onDragStart, nodeViewContentRef } },\r\n                React.createElement(Component, { ...componentProps })));\r\n        };\r\n        ReactNodeViewProvider.displayName = 'ReactNodeView';\r\n        this.contentDOMElement = this.node.isLeaf\r\n            ? null\r\n            : document.createElement(this.node.isInline ? 'span' : 'div');\r\n        if (this.contentDOMElement) {\r\n            // For some reason the whiteSpace prop is not inherited properly in Chrome and Safari\r\n            // With this fix it seems to work fine\r\n            // See: https://github.com/ueberdosis/tiptap/issues/1197\r\n            this.contentDOMElement.style.whiteSpace = 'inherit';\r\n        }\r\n        let as = this.node.isInline ? 'span' : 'div';\r\n        if (this.options.as) {\r\n            as = this.options.as;\r\n        }\r\n        this.renderer = new ReactRenderer(ReactNodeViewProvider, {\r\n            editor: this.editor,\r\n            props,\r\n            as,\r\n            className: `node-${this.node.type.name}`,\r\n        });\r\n    }\r\n    get dom() {\r\n        var _a;\r\n        if (this.renderer.element.firstElementChild\r\n            && !((_a = this.renderer.element.firstElementChild) === null || _a === void 0 ? void 0 : _a.hasAttribute('data-node-view-wrapper'))) {\r\n            throw Error('Please use the NodeViewWrapper component for your node view.');\r\n        }\r\n        return this.renderer.element;\r\n    }\r\n    get contentDOM() {\r\n        if (this.node.isLeaf) {\r\n            return null;\r\n        }\r\n        return this.contentDOMElement;\r\n    }\r\n    update(node, decorations) {\r\n        const updateProps = (props) => {\r\n            this.renderer.updateProps(props);\r\n        };\r\n        if (node.type !== this.node.type) {\r\n            return false;\r\n        }\r\n        if (typeof this.options.update === 'function') {\r\n            const oldNode = this.node;\r\n            const oldDecorations = this.decorations;\r\n            this.node = node;\r\n            this.decorations = decorations;\r\n            return this.options.update({\r\n                oldNode,\r\n                oldDecorations,\r\n                newNode: node,\r\n                newDecorations: decorations,\r\n                updateProps: () => updateProps({ node, decorations }),\r\n            });\r\n        }\r\n        if (node === this.node && this.decorations === decorations) {\r\n            return true;\r\n        }\r\n        this.node = node;\r\n        this.decorations = decorations;\r\n        updateProps({ node, decorations });\r\n        return true;\r\n    }\r\n    selectNode() {\r\n        this.renderer.updateProps({\r\n            selected: true,\r\n        });\r\n    }\r\n    deselectNode() {\r\n        this.renderer.updateProps({\r\n            selected: false,\r\n        });\r\n    }\r\n    destroy() {\r\n        this.renderer.destroy();\r\n        this.contentDOMElement = null;\r\n    }\r\n}\r\nfunction ReactNodeViewRenderer(component, options) {\r\n    return (props) => {\r\n        // try to get the parent component\r\n        // this is important for vue devtools to show the component hierarchy correctly\r\n        // maybe it’s `undefined` because <editor-content> isn’t rendered yet\r\n        if (!props.editor.contentComponent) {\r\n            return {};\r\n        }\r\n        return new ReactNodeView(component, props, options);\r\n    };\r\n}\n\nconst Portals = ({ renderers }) => {\r\n    return (React.createElement(React.Fragment, null, Array.from(renderers).map(([key, renderer]) => {\r\n        return ReactDOM.createPortal(renderer.reactElement, renderer.element, key);\r\n    })));\r\n};\r\nclass PureEditorContent extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.editorContentRef = React.createRef();\r\n        this.state = {\r\n            renderers: new Map(),\r\n        };\r\n    }\r\n    componentDidMount() {\r\n        this.init();\r\n    }\r\n    componentDidUpdate() {\r\n        this.init();\r\n    }\r\n    init() {\r\n        const { editor } = this.props;\r\n        if (editor && editor.options.element) {\r\n            if (editor.contentComponent) {\r\n                return;\r\n            }\r\n            const element = this.editorContentRef.current;\r\n            element.append(...editor.options.element.childNodes);\r\n            editor.setOptions({\r\n                element,\r\n            });\r\n            editor.contentComponent = this;\r\n            editor.createNodeViews();\r\n        }\r\n    }\r\n    componentWillUnmount() {\r\n        const { editor } = this.props;\r\n        if (!editor) {\r\n            return;\r\n        }\r\n        if (!editor.isDestroyed) {\r\n            editor.view.setProps({\r\n                nodeViews: {},\r\n            });\r\n        }\r\n        editor.contentComponent = null;\r\n        if (!editor.options.element.firstChild) {\r\n            return;\r\n        }\r\n        const newElement = document.createElement('div');\r\n        newElement.append(...editor.options.element.childNodes);\r\n        editor.setOptions({\r\n            element: newElement,\r\n        });\r\n    }\r\n    render() {\r\n        const { editor, ...rest } = this.props;\r\n        return (React.createElement(React.Fragment, null,\r\n            React.createElement(\"div\", { ref: this.editorContentRef, ...rest }),\r\n            React.createElement(Portals, { renderers: this.state.renderers })));\r\n    }\r\n}\r\nconst EditorContent = React.memo(PureEditorContent);\n\nconst NodeViewWrapper = React.forwardRef((props, ref) => {\r\n    const { onDragStart } = useReactNodeView();\r\n    const Tag = props.as || 'div';\r\n    return (React.createElement(Tag, { ...props, ref: ref, \"data-node-view-wrapper\": \"\", onDragStart: onDragStart, style: {\r\n            ...props.style,\r\n            whiteSpace: 'normal',\r\n        } }));\r\n});\n\nconst NodeViewContent = props => {\r\n    const Tag = props.as || 'div';\r\n    const { nodeViewContentRef } = useReactNodeView();\r\n    return (React.createElement(Tag, { ...props, ref: nodeViewContentRef, \"data-node-view-content\": \"\", style: {\r\n            ...props.style,\r\n            whiteSpace: 'pre-wrap',\r\n        } }));\r\n};\n\nexport { BubbleMenu, Editor, EditorContent, FloatingMenu, NodeViewContent, NodeViewWrapper, PureEditorContent, ReactNodeViewRenderer, ReactRenderer, useEditor };\n//# sourceMappingURL=tiptap-react.esm.js.map\n"],"names":["Editor$1","useState","useEffect","createContext","useContext","React","ReactDOM"],"mappings":";;;;;;;;;;;;;AAiCA,MAAM,MAAM,SAASA,qBAAQ,CAAC;AAC9B,IAAI,WAAW,GAAG;AAClB,QAAQ,KAAK,CAAC,GAAG,SAAS,CAAC,CAAC;AAC5B,QAAQ,IAAI,CAAC,gBAAgB,GAAG,IAAI,CAAC;AACrC,KAAK;AACL,CAAC;AA2BD;AACA,SAAS,cAAc,GAAG;AAC1B,IAAI,MAAM,GAAG,QAAQ,CAAC,GAAGC,cAAQ,CAAC,CAAC,CAAC,CAAC;AACrC,IAAI,OAAO,MAAM,QAAQ,CAAC,KAAK,IAAI,KAAK,GAAG,CAAC,CAAC,CAAC;AAC9C,CAAC;AACI,MAAC,SAAS,GAAG,CAAC,OAAO,GAAG,EAAE,EAAE,IAAI,GAAG,EAAE,KAAK;AAC/C,IAAI,MAAM,CAAC,MAAM,EAAE,SAAS,CAAC,GAAGA,cAAQ,CAAC,IAAI,CAAC,CAAC;AAC/C,IAAI,MAAM,WAAW,GAAG,cAAc,EAAE,CAAC;AACzC,IAAIC,eAAS,CAAC,MAAM;AACpB,QAAQ,MAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,OAAO,CAAC,CAAC;AAC7C,QAAQ,SAAS,CAAC,QAAQ,CAAC,CAAC;AAC5B,QAAQ,QAAQ,CAAC,EAAE,CAAC,aAAa,EAAE,MAAM;AACzC,YAAY,qBAAqB,CAAC,MAAM;AACxC,gBAAgB,qBAAqB,CAAC,MAAM;AAC5C,oBAAoB,WAAW,EAAE,CAAC;AAClC,iBAAiB,CAAC,CAAC;AACnB,aAAa,CAAC,CAAC;AACf,SAAS,CAAC,CAAC;AACX,QAAQ,OAAO,MAAM;AACrB,YAAY,QAAQ,CAAC,OAAO,EAAE,CAAC;AAC/B,SAAS,CAAC;AACV,KAAK,EAAE,IAAI,CAAC,CAAC;AACb,IAAI,OAAO,MAAM,CAAC;AAClB,EAAE;AA4DF;AACA,MAAM,oBAAoB,GAAGC,mBAAa,CAAC;AAC3C,IAAI,WAAW,EAAE,SAAS;AAC1B,CAAC,CAAC,CAAC;AACH,MAAM,gBAAgB,GAAG,MAAMC,gBAAU,CAAC,oBAAoB,CAAC,CAAC;AA0HhE;AACA,MAAM,OAAO,GAAG,CAAC,EAAE,SAAS,EAAE,KAAK;AACnC,IAAI,QAAQC,yBAAK,CAAC,aAAa,CAACA,yBAAK,CAAC,QAAQ,EAAE,IAAI,EAAE,KAAK,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC,GAAG,EAAE,QAAQ,CAAC,KAAK;AACrG,QAAQ,OAAOC,4BAAQ,CAAC,YAAY,CAAC,QAAQ,CAAC,YAAY,EAAE,QAAQ,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;AACnF,KAAK,CAAC,CAAC,EAAE;AACT,CAAC,CAAC;AACF,MAAM,iBAAiB,SAASD,yBAAK,CAAC,SAAS,CAAC;AAChD,IAAI,WAAW,CAAC,KAAK,EAAE;AACvB,QAAQ,KAAK,CAAC,KAAK,CAAC,CAAC;AACrB,QAAQ,IAAI,CAAC,gBAAgB,GAAGA,yBAAK,CAAC,SAAS,EAAE,CAAC;AAClD,QAAQ,IAAI,CAAC,KAAK,GAAG;AACrB,YAAY,SAAS,EAAE,IAAI,GAAG,EAAE;AAChC,SAAS,CAAC;AACV,KAAK;AACL,IAAI,iBAAiB,GAAG;AACxB,QAAQ,IAAI,CAAC,IAAI,EAAE,CAAC;AACpB,KAAK;AACL,IAAI,kBAAkB,GAAG;AACzB,QAAQ,IAAI,CAAC,IAAI,EAAE,CAAC;AACpB,KAAK;AACL,IAAI,IAAI,GAAG;AACX,QAAQ,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;AACtC,QAAQ,IAAI,MAAM,IAAI,MAAM,CAAC,OAAO,CAAC,OAAO,EAAE;AAC9C,YAAY,IAAI,MAAM,CAAC,gBAAgB,EAAE;AACzC,gBAAgB,OAAO;AACvB,aAAa;AACb,YAAY,MAAM,OAAO,GAAG,IAAI,CAAC,gBAAgB,CAAC,OAAO,CAAC;AAC1D,YAAY,OAAO,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;AACjE,YAAY,MAAM,CAAC,UAAU,CAAC;AAC9B,gBAAgB,OAAO;AACvB,aAAa,CAAC,CAAC;AACf,YAAY,MAAM,CAAC,gBAAgB,GAAG,IAAI,CAAC;AAC3C,YAAY,MAAM,CAAC,eAAe,EAAE,CAAC;AACrC,SAAS;AACT,KAAK;AACL,IAAI,oBAAoB,GAAG;AAC3B,QAAQ,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;AACtC,QAAQ,IAAI,CAAC,MAAM,EAAE;AACrB,YAAY,OAAO;AACnB,SAAS;AACT,QAAQ,IAAI,CAAC,MAAM,CAAC,WAAW,EAAE;AACjC,YAAY,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC;AACjC,gBAAgB,SAAS,EAAE,EAAE;AAC7B,aAAa,CAAC,CAAC;AACf,SAAS;AACT,QAAQ,MAAM,CAAC,gBAAgB,GAAG,IAAI,CAAC;AACvC,QAAQ,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,EAAE;AAChD,YAAY,OAAO;AACnB,SAAS;AACT,QAAQ,MAAM,UAAU,GAAG,QAAQ,CAAC,aAAa,CAAC,KAAK,CAAC,CAAC;AACzD,QAAQ,UAAU,CAAC,MAAM,CAAC,GAAG,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC;AAChE,QAAQ,MAAM,CAAC,UAAU,CAAC;AAC1B,YAAY,OAAO,EAAE,UAAU;AAC/B,SAAS,CAAC,CAAC;AACX,KAAK;AACL,IAAI,MAAM,GAAG;AACb,QAAQ,MAAM,EAAE,MAAM,EAAE,GAAG,IAAI,EAAE,GAAG,IAAI,CAAC,KAAK,CAAC;AAC/C,QAAQ,QAAQA,yBAAK,CAAC,aAAa,CAACA,yBAAK,CAAC,QAAQ,EAAE,IAAI;AACxD,YAAYA,yBAAK,CAAC,aAAa,CAAC,KAAK,EAAE,EAAE,GAAG,EAAE,IAAI,CAAC,gBAAgB,EAAE,GAAG,IAAI,EAAE,CAAC;AAC/E,YAAYA,yBAAK,CAAC,aAAa,CAAC,OAAO,EAAE,EAAE,SAAS,EAAE,IAAI,CAAC,KAAK,CAAC,SAAS,EAAE,CAAC,CAAC,EAAE;AAChF,KAAK;AACL,CAAC;AACI,MAAC,aAAa,GAAGA,yBAAK,CAAC,IAAI,CAAC,iBAAiB,EAAE;AACpD;AACwBA,yBAAK,CAAC,UAAU,CAAC,CAAC,KAAK,EAAE,GAAG,KAAK;AACzD,IAAI,MAAM,EAAE,WAAW,EAAE,GAAG,gBAAgB,EAAE,CAAC;AAC/C,IAAI,MAAM,GAAG,GAAG,KAAK,CAAC,EAAE,IAAI,KAAK,CAAC;AAClC,IAAI,QAAQA,yBAAK,CAAC,aAAa,CAAC,GAAG,EAAE,EAAE,GAAG,KAAK,EAAE,GAAG,EAAE,GAAG,EAAE,wBAAwB,EAAE,EAAE,EAAE,WAAW,EAAE,WAAW,EAAE,KAAK,EAAE;AAC1H,YAAY,GAAG,KAAK,CAAC,KAAK;AAC1B,YAAY,UAAU,EAAE,QAAQ;AAChC,SAAS,EAAE,CAAC,EAAE;AACd,CAAC;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;"}