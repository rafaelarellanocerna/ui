{"version":3,"file":"index.js","sources":["../../../@atoms/AtomImageEditor/index.tsx"],"sourcesContent":["import {\r\n  createRef,\r\n  DragEvent,\r\n  FC,\r\n  FormEvent,\r\n  useEffect,\r\n  useRef,\r\n  useState,\r\n} from 'react';\r\nimport { css, SerializedStyles } from '@emotion/react';\r\nimport { AnimatePresence } from 'framer-motion';\r\nimport AtomImage from '../AtomImage';\r\nimport AtomWrapper from '../AtomWrapper';\r\nimport { getEditorDefaults } from './pintura/pintura';\r\nimport { PinturaEditor } from './react-pintura/index';\r\nimport { ImageEditorStyled } from './styled';\r\n\r\ntype InputImageEditorProps = {\r\n  wrapperCSS?: SerializedStyles;\r\n  inputCSS?: SerializedStyles;\r\n  modalCSS?: SerializedStyles;\r\n  onChangeImageEditor?: ({ url: string, file: File }) => void;\r\n  imagePreview?: string;\r\n  aspectRatio?: number;\r\n};\r\n\r\nconst InputImageEditor: FC<InputImageEditorProps> = (props) => {\r\n  const {\r\n    modalCSS,\r\n    wrapperCSS,\r\n    onChangeImageEditor,\r\n    aspectRatio,\r\n    imagePreview,\r\n  } = props;\r\n  const [blob, setBlob] = useState<string | null>(null);\r\n  const [image, setImage] = useState<string | null>(imagePreview ?? null);\r\n  const [isModal, setIsModal] = useState<boolean>(false);\r\n  const [dropActive, setDropActive] = useState(false);\r\n  const ref = createRef<PinturaEditor>();\r\n  const refInput = useRef<HTMLInputElement>(null);\r\n\r\n  const handleDrag = (e: DragEvent<HTMLLabelElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n  };\r\n\r\n  const Drop = (e: DragEvent<HTMLLabelElement>) => {\r\n    handleDrag(e);\r\n    const { files } = e.dataTransfer;\r\n    if (files.length !== 0) {\r\n      const url = URL?.createObjectURL(files[0]);\r\n      setBlob(url);\r\n      setDropActive(false);\r\n      setIsModal(true);\r\n    } else {\r\n      refInput.current.value = null;\r\n      setBlob(null);\r\n      setDropActive(false);\r\n      setIsModal(false);\r\n    }\r\n  };\r\n\r\n  const DropInput = (e: FormEvent<HTMLInputElement>) => {\r\n    e.preventDefault();\r\n    e.stopPropagation();\r\n    const { files } = e.currentTarget;\r\n\r\n    if (files) {\r\n      if (files.length !== 0) {\r\n        const url = URL?.createObjectURL(files[0]);\r\n        setBlob(url);\r\n        setDropActive(false);\r\n        setIsModal(true);\r\n      } else {\r\n        refInput.current.value = null;\r\n        setBlob(null);\r\n        setDropActive(false);\r\n      }\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const handleClickOutside = (event: MouseEvent) => {\r\n      if (\r\n        ref.current &&\r\n        ref.current.elementRef.current &&\r\n        !ref.current.elementRef.current.contains(event.target as Node)\r\n      ) {\r\n        refInput.current.value = null;\r\n        setBlob(null);\r\n        setImage(null);\r\n        setDropActive(false);\r\n        setIsModal(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener(`mousedown`, handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(`mousedown`, handleClickOutside);\r\n    };\r\n  }, [ref]);\r\n\r\n  return (\r\n    <>\r\n      <AtomWrapper\r\n        customCSS={css`\r\n          width: 250px;\r\n          height: 250px;\r\n          ${wrapperCSS}\r\n        `}\r\n      >\r\n        <ImageEditorStyled\r\n          htmlFor=\"image-editor\"\r\n          onDrop={Drop}\r\n          onDragOver={(e: DragEvent<HTMLLabelElement>) => {\r\n            handleDrag(e);\r\n            setDropActive(true);\r\n          }}\r\n          onDragEnter={(e: DragEvent<HTMLLabelElement>) => handleDrag(e)}\r\n          onDragLeave={(e: DragEvent<HTMLLabelElement>) => {\r\n            handleDrag(e);\r\n            setDropActive(false);\r\n          }}\r\n        >\r\n          {image ? (\r\n            <AtomImage\r\n              alt=\"Drag and drop Preview\"\r\n              src={image}\r\n              customCSS={css`\r\n                position: absolute;\r\n                width: 100%;\r\n                height: 100%;\r\n                object-fit: cover;\r\n              `}\r\n            />\r\n          ) : (\r\n            <AtomWrapper\r\n              flexDirection=\"row\"\r\n              customCSS={css`\r\n                font-size: 14px;\r\n                font-family: 'Montserrat', sans-serif;\r\n                font-weight: 600;\r\n              `}\r\n            >\r\n              {!dropActive ? (\r\n                <>\r\n                  <AtomImage\r\n                    alt=\"Drag and drop\"\r\n                    height=\"15px\"\r\n                    width=\"15px\"\r\n                    margin=\"0px 10px 0px 0px\"\r\n                    src=\"https://storage.googleapis.com/cdn-bucket-ixulabs-platform/assets/svgs/PFS-0001/upload.svg\"\r\n                  />\r\n                  ARRASTRA Y SUELTA\r\n                </>\r\n              ) : (\r\n                <>SUELTA</>\r\n              )}\r\n            </AtomWrapper>\r\n          )}\r\n          <input\r\n            type=\"file\"\r\n            id=\"image-editor\"\r\n            onChange={DropInput}\r\n            ref={refInput}\r\n          />\r\n        </ImageEditorStyled>\r\n      </AtomWrapper>\r\n      <AnimatePresence>\r\n        {isModal && (\r\n          <AtomWrapper\r\n            key={`${isModal}`}\r\n            customCSS={css`\r\n              top: 0;\r\n              left: 0;\r\n              z-index: 1000;\r\n              background-color: #3a3a3a5b;\r\n              position: fixed;\r\n              width: 100vw;\r\n              height: 100vh;\r\n              overflow: hidden;\r\n              justify-content: center;\r\n              align-items: center;\r\n              .PinturaRootWrapper {\r\n                width: 90%;\r\n                max-width: 600px;\r\n                height: 70%;\r\n                max-height: 600px;\r\n              }\r\n              .PinturaRoot {\r\n                background-color: #fafafa;\r\n              }\r\n              .PinturaButtonExport {\r\n                background-color: #f1576c;\r\n                color: #fff;\r\n                :hover {\r\n                  background-color: #c5293e;\r\n                }\r\n              }\r\n              ${modalCSS}\r\n            `}\r\n          >\r\n            <PinturaEditor\r\n              {...getEditorDefaults()}\r\n              src={blob}\r\n              ref={ref}\r\n              utils={['crop', 'filter', 'finetune', 'annotate', 'frame']}\r\n              enableDropImage={false}\r\n              imageCropAspectRatio={aspectRatio ?? 1}\r\n              cropEnableCenterImageSelection\r\n              cropImageSelectionCornerStyle=\"hook\"\r\n              cropAutoCenterImageSelectionTimeout={500}\r\n              // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n              onProcess={(res: any) => {\r\n                const FilterAndCrop = URL.createObjectURL(res.dest);\r\n                onChangeImageEditor?.({ url: FilterAndCrop, file: res.dest });\r\n                setImage(FilterAndCrop);\r\n                setIsModal(false);\r\n              }}\r\n            />\r\n          </AtomWrapper>\r\n        )}\r\n      </AnimatePresence>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default InputImageEditor;\r\n"],"names":["__read","useState","createRef","useRef","useEffect","_jsxs","_Fragment","_jsx","AtomWrapper","__assign","css","__makeTemplateObject","ImageEditorStyled","AtomImage","AnimatePresence","getEditorDefaults"],"mappings":"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"}