{"version":3,"file":"index.js","sources":["../../../@hooks/useUploadFile/index.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-unused-vars */\r\nimport { ApolloError, gql, useMutation } from '@apollo/client';\r\nimport { IMutationFilter, IUploadFilePrivatePayload } from '@ixulabs/ui';\r\n\r\nconst UPLOADMUTATION = gql`\r\n  mutation uploadFilePrivate($input: UploadFilePrivateInput!) {\r\n    uploadFilePrivate(input: $input) {\r\n      url\r\n      message\r\n      token\r\n      fileId\r\n      partialUrl\r\n    }\r\n  }\r\n`;\r\n\r\nconst uploadFile = (url: string, file: File) =>\r\n  fetch(url, {\r\n    method: 'PUT',\r\n    body: file,\r\n    headers: {\r\n      'Content-Type': 'application/octet-stream',\r\n    },\r\n    mode: 'cors',\r\n  }).catch((e) => console.error(e));\r\n\r\nexport type useUploadFileVariables = {\r\n  fileInput: File;\r\n  projectId: string;\r\n  memberId: string;\r\n  isProfile: boolean;\r\n  descriptionType?: string;\r\n};\r\n\r\ntype OPTIONSHOOK = {\r\n  onCompleted(data: IuseUploadFileResult): void;\r\n  onError(error: ApolloError): void;\r\n};\r\nexport type IuseUploadFileResult = IUploadFilePrivatePayload & {\r\n  name: string;\r\n  fileName: string;\r\n  description: {\r\n    size: string;\r\n    type: string;\r\n  };\r\n};\r\n\r\nconst removeWhiteSpaces = (name: string) =>\r\n  name?.replace(/\\s+/g, '')?.replace('(', '')?.replace(')', '');\r\n\r\nexport const useUploadFile = (options?: OPTIONSHOOK) => {\r\n  const [EXECUTEFILE, data] =\r\n    useMutation<IMutationFilter<'uploadFilePrivate'>>(UPLOADMUTATION);\r\n  return {\r\n    uploadFile: (values: useUploadFileVariables, optionsByFn?: OPTIONSHOOK) => {\r\n      return EXECUTEFILE({\r\n        variables: {\r\n          input: {\r\n            memberId: values.memberId,\r\n            projectId: values.projectId,\r\n            isProfile: values.isProfile,\r\n            name: removeWhiteSpaces(values.fileInput?.name),\r\n            fileName: removeWhiteSpaces(values.fileInput?.name),\r\n            description:\r\n              values?.descriptionType ??\r\n              JSON.stringify({\r\n                size: values.fileInput.size,\r\n                type: `${values.fileInput?.type}`,\r\n              }),\r\n          },\r\n        },\r\n        onCompleted: async (response) => {\r\n          const result = {\r\n            ...response.uploadFilePrivate,\r\n            name: removeWhiteSpaces(values.fileInput?.name),\r\n            fileName: removeWhiteSpaces(values.fileInput?.name),\r\n            description: values?.descriptionType ?? {\r\n              size: `${values.fileInput.size}`,\r\n              type: `${values.fileInput?.type}`,\r\n            },\r\n          } as IuseUploadFileResult;\r\n\r\n          await uploadFile(\r\n            response?.uploadFilePrivate?.partialUrl,\r\n            values?.fileInput\r\n          );\r\n          options?.onCompleted(result);\r\n          optionsByFn?.onCompleted(result);\r\n          return response;\r\n        },\r\n        onError: (error) => {\r\n          options?.onError(error);\r\n          optionsByFn?.onError(error);\r\n        },\r\n      });\r\n    },\r\n    ...data,\r\n  };\r\n};\r\n"],"names":["gql","__makeTemplateObject","__read","useMutation","__assign","__awaiter"],"mappings":"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"}