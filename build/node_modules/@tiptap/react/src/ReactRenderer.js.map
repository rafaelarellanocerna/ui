{"version":3,"file":"ReactRenderer.js","sources":["../../../../../node_modules/@tiptap/react/src/ReactRenderer.tsx"],"sourcesContent":["import React from 'react'\nimport { Editor } from '@tiptap/core'\nimport { Editor as ExtendedEditor } from './Editor'\n\nfunction isClassComponent(Component: any) {\n  return !!(\n    typeof Component === 'function'\n    && Component.prototype\n    && Component.prototype.isReactComponent\n  )\n}\n\nfunction isForwardRefComponent(Component: any) {\n  return !!(\n    typeof Component === 'object'\n    && Component.$$typeof?.toString() === 'Symbol(react.forward_ref)'\n  )\n}\n\nexport interface ReactRendererOptions {\n  editor: Editor,\n  props?: Record<string, any>,\n  as?: string,\n  className?: string,\n}\n\ntype ComponentType<R, P> =\n  React.ComponentClass<P> |\n  React.FunctionComponent<P> |\n  React.ForwardRefExoticComponent<React.PropsWithoutRef<P> & React.RefAttributes<R>>;\n\nexport class ReactRenderer<R = unknown, P = unknown> {\n  id: string\n\n  editor: ExtendedEditor\n\n  component: any\n\n  element: Element\n\n  props: Record<string, any>\n\n  reactElement: React.ReactNode\n\n  ref: R | null = null\n\n  constructor(component: ComponentType<R, P>, {\n    editor,\n    props = {},\n    as = 'div',\n    className = '',\n  }: ReactRendererOptions) {\n    this.id = Math.floor(Math.random() * 0xFFFFFFFF).toString()\n    this.component = component\n    this.editor = editor as ExtendedEditor\n    this.props = props\n    this.element = document.createElement(as)\n    this.element.classList.add('react-renderer')\n\n    if (className) {\n      this.element.classList.add(...className.split(' '))\n    }\n\n    this.render()\n  }\n\n  render(): void {\n    const Component = this.component\n    const props = this.props\n\n    if (isClassComponent(Component) || isForwardRefComponent(Component)) {\n      props.ref = (ref: R) => {\n        this.ref = ref\n      }\n    }\n\n    this.reactElement = <Component {...props } />\n\n    if (this.editor?.contentComponent) {\n      this.editor.contentComponent.setState({\n        renderers: this.editor.contentComponent.state.renderers.set(\n          this.id,\n          this,\n        ),\n      })\n    }\n  }\n\n  updateProps(props: Record<string, any> = {}): void {\n    this.props = {\n      ...this.props,\n      ...props,\n    }\n\n    this.render()\n  }\n\n  destroy(): void {\n    if (this.editor?.contentComponent) {\n      const { renderers } = this.editor.contentComponent.state\n\n      renderers.delete(this.id)\n\n      this.editor.contentComponent.setState({\n        renderers,\n      })\n    }\n  }\n}\n"],"names":["__spreadArray","__read","_jsx","__assign"],"mappings":"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"}